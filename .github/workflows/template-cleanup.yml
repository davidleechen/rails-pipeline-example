name: Template Cleanup

# This workflow runs once when a repository is created from this template
# It helps guide users to rename their application

on:
  create:
  push:
    branches:
      - main

jobs:
  template-cleanup:
    name: Template Cleanup
    runs-on: ubuntu-latest
    # Only run if this appears to be a repository created from the template
    if: github.event.repository.name != 'rails-pipeline-example'
    
    steps:
      - name: Check if cleanup is needed
        id: check
        run: |
          if grep -q "rails-pipeline-example" README.md 2>/dev/null; then
            echo "needs_cleanup=true" >> $GITHUB_OUTPUT
          else
            echo "needs_cleanup=false" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true
        
      - name: Post instructions
        if: steps.check.outputs.needs_cleanup == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ðŸš€ Welcome! Please rename your application',
              body: `## Welcome to your new Rails application!

            This repository was created from the rails-pipeline-example template.
            
            ### Next Steps:
            
            1. **Rename your application** by running:
               \`\`\`bash
               bin/rename_application ${context.repo.repo}
               \`\`\`
            
            2. **Review the changes** and update any remaining references to your GitHub username:
               - Update \`README.md\` to replace \`davidleechen\` with your username
               - Update \`config/deploy.yml\` with your deployment settings
            
            3. **Commit your changes**:
               \`\`\`bash
               git add .
               git commit -m "Configure application from template"
               git push
               \`\`\`
            
            4. **Read the template documentation** at [TEMPLATE.md](TEMPLATE.md) for detailed instructions
            
            5. **Close this issue** once you've completed the setup
            
            ---
            
            For more information, see [TEMPLATE.md](TEMPLATE.md).
            
            This issue was automatically created to help you get started. You can safely close it once you've completed the setup.`
            });
            
            console.log(\`Created issue #\${issue.data.number}\`);
